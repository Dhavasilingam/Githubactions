name: Launch EC2 Instance

on: [push]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2
    
    - name: Configure AWS credentials
      run: |
        echo "::set-env name=AWS_ACCESS_KEY::${{ secrets.AWS_ACCESS_KEY }}"
        echo "::set-env name=AWS_SECRET_KEY::${{ secrets.AWS_SECRET_KEY }}"
        echo "::set-env name=AWS_REGION::us-west-2"
      env:
        AWS_ACCESS_KEY: ${{ secrets.AWS_ACCESS_KEY }}
        AWS_SECRET_KEY: ${{ secrets.AWS_SECRET_KEY }}
        AWS_REGION: us-west-2
      
    - name: Install AWS CLI
      run: |
        apt-get update
        apt-get install -y python-pip
        pip install awscli --upgrade --user
      
    - name: Launch EC2 instance
      run: |
        aws ec2 run-instances --image-id ami-0a313d6098716f372 --count 1 --instance-type t2.micro --key-name MyKeyPair --security-group-ids sg-01234567890abcdef0 --subnet-id subnet-01234567890abcdef0
